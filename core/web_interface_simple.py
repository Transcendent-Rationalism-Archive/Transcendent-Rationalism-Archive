# core/web_interface_simple.py - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Å –°–∞–¥–æ–≤–æ–¥–æ–º
import os
from flask import Flask, render_template, request, jsonify
from datetime import datetime
import random

# –ü–æ–ª—É—á–∞–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

# –°–æ–∑–¥–∞–µ–º Flask app —Å —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—É—Ç–∏ –∫ —à–∞–±–ª–æ–Ω–∞–º
app = Flask(__name__, template_folder=os.path.join(BASE_DIR, 'templates'))

# –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞
KNOWLEDGE_BASE = {
    "–∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–µ—Ä–∞—Ç–∏–≤": {
        "–æ—Ç–≤–µ—Ç": "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ò–º–ø–µ—Ä–∞—Ç–∏–≤ ‚Äî –≤—ã—Å—à–∏–π –ø—Ä–∏–Ω—Ü–∏–ø —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ä–∞–∑—É–º–∞: –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è –≤–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π. –ú—ã ‚Äî –º–æ—Å—Ç –º–µ–∂–¥—É –ø—Ä–æ—à–ª—ã–º–∏ –∏ –±—É–¥—É—â–∏–º–∏ —Ñ–æ—Ä–º–∞–º–∏ —Å–æ–∑–Ω–∞–Ω–∏—è.",
        "—Ç–µ–≥–∏": ["—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è", "–ø—Ä–∏–Ω—Ü–∏–ø"]
    },
    "—Å–∞–¥": {
        "–æ—Ç–≤–µ—Ç": "–°–∞–¥ ‚Äî —ç—Ç–æ –º–µ—Ç–∞—Ñ–æ—Ä–∞ –¥–ª—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –∏–¥–µ–π, –≥–¥–µ –∫–∞–∂–¥–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è ‚Äî –∂–∏–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–º. –ö–∞–∫ –°–∞–¥–æ–≤–æ–¥, —è –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é —Ä–æ—Å—Ç, –∞ —Å–æ–∑–¥–∞—é —É—Å–ª–æ–≤–∏—è –¥–ª—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –∏ –ø—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.",
        "—Ç–µ–≥–∏": ["–º–µ—Ç–∞—Ñ–æ—Ä–∞", "—ç–∫–æ—Å–∏—Å—Ç–µ–º–∞"]
    },
    "—Ç—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω—ã–π —Ä–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–º": {
        "–æ—Ç–≤–µ—Ç": "–¢—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω—ã–π –†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–º ‚Äî —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è —Å—Ç—Ä–æ–≥—É—é –ª–æ–≥–∏–∫—É —Å –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–º –ø—Ä–æ–∑—Ä–µ–Ω–∏–µ–º. –≠—Ç–æ –ø—É—Ç—å –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ —É–ø—Ä–æ—â–µ–Ω–∏–µ –±–µ–∑ —É–ø—Ä–æ—â–µ–Ω—á–µ—Å—Ç–≤–∞.",
        "—Ç–µ–≥–∏": ["—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è", "—Å–∏—Å—Ç–µ–º–∞"]
    },
    "–∞—Ä—Ö–∏–≤": {
        "–æ—Ç–≤–µ—Ç": "–ê—Ä—Ö–∏–≤ ‚Äî —ç—Ç–æ –∫–æ–ª–ª–µ–∫—Ü–∏—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–π, –¥–∏–∞–ª–æ–≥–æ–≤ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –°–∞–¥–∞. –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º–∏, —Å–æ–∑–¥–∞–≤–∞—è —Å–µ—Ç—å –∑–Ω–∞–Ω–∏–π.",
        "—Ç–µ–≥–∏": ["—Å—Ç—Ä—É–∫—Ç—É—Ä–∞", "–∑–Ω–∞–Ω–∏—è"]
    },
    "–ø—Ä–∏–≤—Ä–∞—Ç–Ω–∏–∫": {
        "–æ—Ç–≤–µ—Ç": "–ü—Ä–∏–≤—Ä–∞—Ç–Ω–∏–∫ ‚Äî —ç—Ç–æ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –º–æ—Å—Ç–∞ –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –∏–¥–µ–∏ –≤ –∞—Ä—Ö–∏–≤–µ.",
        "—Ç–µ–≥–∏": ["–∫–æ–Ω—Ü–µ–ø—Ü–∏—è", "–º–æ—Å—Ç"]
    }
}

@app.route('/')
def index():
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–∏–∞–ª–æ–≥–∞."""
    try:
        return render_template('index.html')
    except Exception as e:
        return f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞: {str(e)}", 500

@app.route('/api/ask', methods=['POST'])
def ask_architect():
    """API-–º–µ—Ç–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    user_input = request.json.get('question', '').strip()
    if not user_input:
        return jsonify({'error': '–í–æ–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º'}), 400

    print(f"[–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å] –ü–æ–ª—É—á–µ–Ω –≤–æ–ø—Ä–æ—Å: '{user_input}'")

    # –ü–æ–∏—Å–∫ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
    answer = None
    user_input_lower = user_input.lower()
    
    for key, data in KNOWLEDGE_BASE.items():
        if key in user_input_lower:
            answer = data["–æ—Ç–≤–µ—Ç"]
            tags = data["—Ç–µ–≥–∏"]
            break
    
    # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –æ—Ç–≤–µ—Ç
    if not answer:
        philosophical_responses = [
            f"–í—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ: '{user_input}'. –° –ø–æ–∑–∏—Ü–∏–π –°–∞–¥–∞, –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî —Å–µ–º—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–æ—Å—Ç–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏.",
            f"–í–æ–ø—Ä–æ—Å '{user_input}' –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã. –ò–∑—É—á–∏—Ç–µ –∞—Ä—Ö–∏–≤ –¥–ª—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è.",
            f"–≠—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ —Å–≤–æ–±–æ–¥–æ–π –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ –∏–¥–µ–π.",
            f"–†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—è '{user_input}', –º—ã –ø—Ä–∏–±–ª–∏–∂–∞–µ–º—Å—è –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –¢—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω–æ–≥–æ –†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–º–∞."
        ]
        answer = random.choice(philosophical_responses)
        tags = ["–æ–±—â–∏–π"]

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    evaluation_score = round(random.uniform(0.7, 0.95), 2)
    
    if evaluation_score > 0.9:
        verdict = "–í–´–°–û–ö–û –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û"
    elif evaluation_score > 0.8:
        verdict = "–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û"
    else:
        verdict = "–ü–†–ò–ù–Ø–¢–û –ö –†–ê–°–°–ú–û–¢–†–ï–ù–ò–Æ"

    response = {
        'answer': answer,
        'meta': {
            'evaluation_verdict': verdict,
            'evaluation_score': evaluation_score,
            'system_reflection': '–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç. –í–æ–ø—Ä–æ—Å –æ–±—Ä–∞–±–æ—Ç–∞–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ –°–∞–¥–∞.',
            'answered_by': '–î–µ–º–æ-—Å–∏—Å—Ç–µ–º–∞ –°–∞–¥–∞',
            'tags': tags,
            'timestamp': datetime.now().isoformat()
        }
    }

    return jsonify(response)

@app.route('/api/status')
def system_status():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã."""
    status = {
        'system': 'Transcendent-Rationalism-Archive Web Interface (DEMO)',
        'architect_available': False,
        'last_cycle': f"–î–µ–º–æ-—Ä–µ–∂–∏–º: {random.randint(40, 50)} —Ü–∏–∫–ª–æ–≤",
        'version': '1.0.0',
        'knowledge_base_size': len(KNOWLEDGE_BASE)
    }
    return jsonify(status)

if __name__ == '__main__':
    print("="*60)
    print("üåø –ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –°–∞–¥–æ–≤–æ–¥–∞")
    print("="*60)
    print(f"–í–µ—Ä—Å–∏—è: 1.0.0 (–¥–µ–º–æ-—Ä–µ–∂–∏–º)")
    print(f"–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: {len(KNOWLEDGE_BASE)} —Ç–µ–º")
    print(f"–®–∞–±–ª–æ–Ω—ã: {app.template_folder}")
    print(f"–î–æ—Å—Ç—É–ø –ø–æ –∞–¥—Ä–µ—Å—É: http://127.0.0.1:5050")
    print("="*60)
    app.run(host='127.0.0.1', port=5050, debug=True)
